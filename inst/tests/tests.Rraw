# This file should be clean of non-ASCII characters; e.g. CRAN Solaris
# Use:  grep --color='auto' -P -n "[\x80-\xFF]" tests.Rraw
if (!exists("test_ggfastqc", .GlobalEnv, inherits=FALSE)) {
    require(ggfastqc)   # in dev the package should not be loaded
    options(warn=0L) # use require() to warn but not halt if not available
    .devtesting=FALSE

    test    = ggfastqc:::test
} else {
    .devtesting=TRUE
}

sugg_pkgs = c("data.table", "ggplot2", "plotly", "RColorBrewer", 
                "ggrepel", "Biobase")
inst_pkgs = rownames(installed.packages())
lapply(setNames(sugg_pkgs, nm = sugg_pkgs), function(pkg) if(pkg %in% 
    inst_pkgs) require(pkg, character.only=TRUE))

INT = function(...) as.integer(c(...))

options(warn=2L)
nfail = ntest = lastnum = 0L
whichfail = NULL
.timingtests = FALSE
started.at = Sys.time()

## rnaseq ----------------------------------------------------
info = "./fastqc-sample/annotation.txt"
fasqc_obj = fastqc(info)

test(1.0, class(fastqc_obj)[1L], "fastqc")

## test summary ----------------------------------------------
options(warn=0L)
plat = paste("endian=",.Platform$endian,", sizeof(long double)==",
                    .Machine$sizeof.longdouble,sep="")
if (nfail > 0) {
    if (nfail>1) {s1="s";s2="s: "} else {s1="";s2=" "}
    cat("\r")
    stop(nfail," error",s1," out of ",ntest, " (lastID=",
        lastnum,", ",plat, ") in inst/tests/tests.Rraw on ",
        date(),". Search tests.Rraw for test number",s2,
        paste(whichfail,collapse=", "),".")
    # important to stop() here, so that 'R CMD check' fails
}
cat("\rAll ",ntest," tests (lastID=",lastnum,
    ") in inst/tests/tests.Rraw completed ok in ",
    timetaken(started.at)," on ",
    date()," (",plat,")\n",sep="")
